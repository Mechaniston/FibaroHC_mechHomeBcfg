{"name":"Жалюзи","type":"virtual_device","properties":{"deviceIcon":0,"currentIcon":"0","log":"","logTemp":"","mainLoop":"local midPos = tonumber(fibaro:getGlobalValue(\"blindsMidPos\"));\nlocal sidesPos = tonumber(fibaro:getGlobalValue(\"blindsSidesPos\"));\n\nfibaro:call(189, \"setProperty\", \"ui.Slider2.value\", midPos);\nfibaro:call(189, \"setProperty\", \"ui.Slider3.value\", sidesPos);\nfibaro:call(189, \"setProperty\", \"ui.Slider1.value\",\n  math.floor( (midPos + sidesPos) / 2 )\n  );\n\nfibaro:sleep(5 * 1000); -- 5 sec\n","ui.Slider1.value":75,"ui.Slider2.value":50,"ui.Slider3.value":100,"visible":"true","rows":[{"type":"slider","elements":[{"id":1,"lua":true,"waitForResponse":false,"caption":"Все секции","name":"Slider1","msg":"fibaro:call(189, \"setProperty\", \"ui.Slider2.value\", _sliderValue_);\nfibaro:call(189, \"setProperty\", \"ui.Slider3.value\", _sliderValue_);\nfibaro:startScene(200); -- BR_blindsControl\n","buttonIcon":0,"value":75,"favourite":false,"main":true}]},{"type":"button","elements":[{"id":2,"lua":true,"waitForResponse":false,"caption":"ОТКР","name":"Button11","empty":false,"msg":"fibaro:call(189, \"setProperty\", \"ui.Slider2.value\", \"100\");\nfibaro:call(189, \"setProperty\", \"ui.Slider3.value\", \"100\");\nfibaro:startScene(200); -- BR_blindsControl\n","buttonIcon":0,"favourite":false,"main":true},{"id":3,"lua":true,"waitForResponse":false,"caption":"ВИД","name":"Button12","empty":false,"msg":"fibaro:call(189, \"setProperty\", \"ui.Slider2.value\", \"50\");\nfibaro:call(189, \"setProperty\", \"ui.Slider3.value\", \"50\");\nfibaro:startScene(200); -- BR_blindsControl\n","buttonIcon":0,"favourite":false,"main":false},{"id":4,"lua":true,"waitForResponse":false,"caption":"ЗАКР","name":"Button13","empty":false,"msg":"fibaro:call(189, \"setProperty\", \"ui.Slider2.value\", \"0\");\nfibaro:call(189, \"setProperty\", \"ui.Slider3.value\", \"0\");\nfibaro:startScene(200); -- BR_blindsControl\n","buttonIcon":0,"favourite":false,"main":false}]},{"type":"slider","elements":[{"id":5,"lua":true,"waitForResponse":false,"caption":"Средняя","name":"Slider2","msg":"fibaro:startScene(200); -- BR_blindsControl\n\n--[[\n-- CONSTS\n\nlocal moveTime  = 20 * 1000;\nlocal knockTime = 300;\nlocal relaxTime = 5 * 1000;\n\nlocal blindsID = 181;\n\nlocal debugMode = true;\n\n\n-- GET ENVS\n\nlocal pos = tonumber(_sliderValue_);\nif debugMode then fibaro:debug(\"slider = \" .. tostring(pos)); end\n\nif pos > 5 and pos < 50 then\n  pos = 25;\nelseif pos >= 50 then\n  pos = 100;\nend;\n\nlocal blindsPos = tonumber(fibaro:getGlobalValue(\"blindsMidPos\"));\nif debugMode then fibaro:debug(\"blindsMidPos = \" .. tostring(blindsPos)); end\n\n\n-- PROCESS\n\nif pos ~= blindsPos then\n  \n  if blindsPos == 0 then\n    \n    if debugMode then fibaro:debug(\"Blinds MOVE!\"); end\n    fibaro:call(blindsID, \"turnOn\");\n    \n    if pos == 25 then\n      -- knock\n      if debugMode then fibaro:debug(\"- knock time\"); end\n      fibaro:sleep(knockTime);\n    elseif pos == 100 then\n      -- full up\n      if debugMode then fibaro:debug(\"- move time\"); end\n      fibaro:sleep(moveTime);\n    end\n    \n    if debugMode then fibaro:debug(\"Blinds STOP!\"); end\n    fibaro:call(blindsID, \"turnOff\");\n    \n  elseif blindsPos == 25 or blindsPos == 100 then\n    \n    if debugMode then fibaro:debug(\"Blinds MOVE on full time and STOP!\"); end\n                  \n    fibaro:call(blindsID, \"turnOn\");\n    fibaro:sleep(moveTime);\n    fibaro:call(blindsID, \"turnOff\");\n    \n    if debugMode then fibaro:debug(\"- relax time\"); end\n    fibaro:sleep(relaxTime);\n\n    if debugMode then fibaro:debug(\"Blinds MOVE!\"); end\n    fibaro:call(blindsID, \"turnOn\");\n    \n    if pos == 0 then -- need to close\n      if debugMode then fibaro:debug(\"- move time\"); end\n      fibaro:sleep(moveTime);\n    elseif pos == 25 then -- need to open view\n      if debugMode then fibaro:debug(\"- knock time\"); end\n      fibaro:sleep(knockTime);\n    end;\n    \n    if debugMode then fibaro:debug(\"Blinds STOP!\"); end\n    fibaro:call(blindsID, \"turnOff\");\n    \n  end;\n  \n  fibaro:setGlobal(\"blindsMidPos\", pos);\n  \nend;\n\nfibaro:call(189, \"setProperty\", \"ui.Slider1.value\", tostring(\n\t\n    math.floor(\n      (fibaro:getGlobalValue(\"blindsMidPos\")\n        + fibaro:getGlobalValue(\"blindsSidesPos\")) / 2)\n    \n));\n--]]\n","buttonIcon":0,"value":50,"favourite":false,"main":false}]},{"type":"slider","elements":[{"id":6,"lua":true,"waitForResponse":false,"caption":"Боковые","name":"Slider3","msg":"fibaro:startScene(200); -- BR_blindsControl\n\n--[[\n-- CONSTS\n\nlocal moveTime  = 20 * 1000;\nlocal knockTime = 300;\nlocal relaxTime = 5 * 1000;\n\nlocal blindsID = 183;\n\nlocal debugMode = true;\n\n\n-- GET ENVS\n\nlocal pos = tonumber(_sliderValue_);\nif debugMode then fibaro:debug(\"slider = \" .. tostring(pos)); end\n\nif pos > 5 and pos < 50 then\n  pos = 25;\nelseif pos >= 50 then\n  pos = 100;\nend;\n\nlocal blindsPos = tonumber(fibaro:getGlobalValue(\"blindsSidesPos\"));\nif debugMode then fibaro:debug(\"blindsSidesPos = \" .. tostring(blindsPos)); end\n\n\n-- PROCESS\n\nif pos ~= blindsPos then\n  \n  if blindsPos == 0 then\n    \n    if debugMode then fibaro:debug(\"Blinds MOVE!\"); end\n    fibaro:call(blindsID, \"turnOn\");\n    \n    if pos == 25 then\n      -- knock\n      if debugMode then fibaro:debug(\"- knock time\"); end\n      fibaro:sleep(knockTime);\n    elseif pos == 100 then\n      -- full up\n      if debugMode then fibaro:debug(\"- move time\"); end\n      fibaro:sleep(moveTime);\n    end\n    \n    if debugMode then fibaro:debug(\"Blinds STOP!\"); end\n    fibaro:call(blindsID, \"turnOff\");\n    \n  elseif blindsPos == 25 or blindsPos == 100 then\n    \n    if debugMode then fibaro:debug(\"Blinds MOVE on full time and STOP!\"); end\n                  \n    fibaro:call(blindsID, \"turnOn\");\n    fibaro:sleep(moveTime);\n    fibaro:call(blindsID, \"turnOff\");\n    \n    if debugMode then fibaro:debug(\"- relax time\"); end\n    fibaro:sleep(relaxTime);\n\n    if debugMode then fibaro:debug(\"Blinds MOVE!\"); end\n    fibaro:call(blindsID, \"turnOn\");\n    \n    if pos == 0 then -- need to close\n      if debugMode then fibaro:debug(\"- move time\"); end\n      fibaro:sleep(moveTime);\n    elseif pos == 25 then -- need to open view\n      if debugMode then fibaro:debug(\"- knock time\"); end\n      fibaro:sleep(knockTime);\n    end;\n    \n    if debugMode then fibaro:debug(\"Blinds STOP!\"); end\n    fibaro:call(blindsID, \"turnOff\");\n    \n  end;\n  \n  fibaro:setGlobal(\"blindsSidesPos\", pos);\n  \nend;\n\nfibaro:call(189, \"setProperty\", \"ui.Slider1.value\", tostring(\n\t\n    math.floor(\n      (fibaro:getGlobalValue(\"blindsMidPos\")\n        + fibaro:getGlobalValue(\"blindsSidesPos\")) / 2)\n    \n));\n--]]\n","buttonIcon":0,"value":100,"favourite":false,"main":false}]}]},"actions":{"pressButton":1,"setSlider":2,"setProperty":2}}