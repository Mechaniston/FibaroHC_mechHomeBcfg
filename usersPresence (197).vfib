{"name":"usersPresence","type":"virtual_device","properties":{"deviceIcon":0,"currentIcon":"0","log":"","logTemp":"","mainLoop":"--[[\nlocal txt = \"\";\nlocal sumUsers = 0;\n\n-----\n\nlocal inout = fibaro:getGlobalValue(\"mechInHomeB\");\nlocal dist, MT = fibaro:getGlobal(\"mech_distance\");\n\nif inout == \"1\" then\n  txt = \"IN\";\n  sumUsers = sumUsers + 1;\nelse\n  txt = \"OUT OF\";\nend;\ntxt = txt .. \" home (\" .. dist .. \")\";\nfibaro:call(197, \"setProperty\", \"ui.Label1.value\", txt);\nfibaro:call(197, \"setProperty\", \"ui.Label2.value\", os.date(\"%d.%m %X\", MT));\n\n-----\n\nlocal inout = fibaro:getGlobalValue(\"LenaInHomeB\");\nlocal dist, MT = fibaro:getGlobal(\"Lena_distance\");\n\nif inout == \"1\" then\n  txt = \"IN\";\n  sumUsers = sumUsers + 1;\nelse\n  txt = \"OUT OF\";\nend;\ntxt = txt .. \" home (\" .. dist .. \")\";\nfibaro:call(197, \"setProperty\", \"ui.Label3.value\", txt);\nfibaro:call(197, \"setProperty\", \"ui.Label4.value\", os.date(\"%d.%m %X\", MT));\n\n-----\n\nlocal inout = fibaro:getGlobalValue(\"LeraInHomeB\");\nlocal dist, MT = fibaro:getGlobal(\"Lera_distance\");\n\nif inout == \"1\" then\n  txt = \"IN\";\n  sumUsers = sumUsers + 1;\nelse\n  txt = \"OUT OF\";\nend;\ntxt = txt .. \" home (\" .. dist .. \")\";\nfibaro:call(197, \"setProperty\", \"ui.Label5.value\", txt);\nfibaro:call(197, \"setProperty\", \"ui.Label6.value\", os.date(\"%d.%m %X\", MT));\n\n-----\n\nfibaro:call(197, \"setProperty\", \"ui.Slider1.value\", tostring(sumUsers * 33));\n\nfibaro:sleep(5 * 60 * 1000); -- five minutes\n--]]\n\n\n\n--fibaro:sleep(3 * 1000); -- three sec\n","ui.Label1.value":"OUT OF home (356)","ui.Label2.value":"12.01 13:50:01","ui.Label3.value":"IN home (226)","ui.Label4.value":"14.01 14:15:01","ui.Label5.value":"OUT OF home (19717)","ui.Label6.value":"04.01 02:50:11","ui.Slider1.value":33,"visible":"true","rows":[{"type":"label","elements":[{"id":1,"lua":false,"waitForResponse":false,"caption":"mech","name":"Label1","favourite":true,"main":false}]},{"type":"label","elements":[{"id":2,"lua":false,"waitForResponse":false,"caption":"- updated:","name":"Label2","favourite":false,"main":false}]},{"type":"button","elements":[{"id":3,"lua":true,"waitForResponse":false,"caption":"IN","name":"Button31","empty":false,"msg":"fibaro:setGlobal(\"mechInHomeB\", 1);\nfibaro:call(197, \"pressButton\", 14);","buttonIcon":0,"favourite":false,"main":false},{"id":4,"lua":true,"waitForResponse":false,"caption":"OUT","name":"Button32","empty":false,"msg":"fibaro:setGlobal(\"mechInHomeB\", 0);\nfibaro:call(197, \"pressButton\", 14);","buttonIcon":0,"favourite":false,"main":false}]},{"type":"label","elements":[{"id":5,"lua":false,"waitForResponse":false,"caption":"Lena","name":"Label3","favourite":true,"main":false}]},{"type":"label","elements":[{"id":6,"lua":false,"waitForResponse":false,"caption":"- updated:","name":"Label4","favourite":false,"main":false}]},{"type":"button","elements":[{"id":7,"lua":true,"waitForResponse":false,"caption":"IN","name":"Button41","empty":false,"msg":"fibaro:setGlobal(\"LenaInHomeB\", 1);\nfibaro:call(197, \"pressButton\", 14);","buttonIcon":0,"favourite":false,"main":false},{"id":8,"lua":true,"waitForResponse":false,"caption":"OUT","name":"Button42","empty":false,"msg":"fibaro:setGlobal(\"LenaInHomeB\", 0);\nfibaro:call(197, \"pressButton\", 14);","buttonIcon":0,"favourite":false,"main":false}]},{"type":"label","elements":[{"id":9,"lua":false,"waitForResponse":false,"caption":"Lera","name":"Label5","favourite":true,"main":false}]},{"type":"label","elements":[{"id":10,"lua":false,"waitForResponse":false,"caption":"- updated:","name":"Label6","favourite":false,"main":false}]},{"type":"button","elements":[{"id":11,"lua":true,"waitForResponse":false,"caption":"IN","name":"Button51","empty":false,"msg":"fibaro:setGlobal(\"LeraInHomeB\", 1);\nfibaro:call(197, \"pressButton\", 14);","buttonIcon":0,"favourite":false,"main":false},{"id":12,"lua":true,"waitForResponse":false,"caption":"OUT","name":"Button52","empty":false,"msg":"fibaro:setGlobal(\"LeraInHomeB\", 0);\nfibaro:call(197, \"pressButton\", 14);","buttonIcon":0,"favourite":false,"main":false}]},{"type":"slider","elements":[{"id":13,"lua":true,"waitForResponse":false,"caption":"UserCount","name":"Slider1","msg":"fibaro:debug(_sliderValue_);\nfibaro:debug(fibaro:getValue(197, \"ui.Slider1.value\"));","buttonIcon":0,"value":33,"favourite":false,"main":true}]},{"type":"button","elements":[{"id":14,"lua":true,"waitForResponse":false,"caption":"update info","name":"Button11","empty":false,"msg":"--fibaro:startScene(184);\n\nlocal txt = \"\";\nlocal sumUsers = 0;\n\n-----\n\nlocal inout, MT = fibaro:getGlobal(\"mechInHomeB\");\nlocal dist = fibaro:getGlobalValue(\"mech_distance\");\n\nif ( inout == \"1\" ) then\n  txt = \"IN\";\n  sumUsers = sumUsers + 1;\nelse\n  txt = \"OUT OF\";\nend;\ntxt = txt .. \" home (\" .. dist .. \")\";\nfibaro:call(197, \"setProperty\", \"ui.Label1.value\",\n  txt);\nfibaro:call(197, \"setProperty\", \"ui.Label2.value\",\n  os.date(\"%d.%m %X\", MT));\n\n-----\n\nlocal inout, MT = fibaro:getGlobal(\"LenaInHomeB\");\nlocal dist = fibaro:getGlobalValue(\"Lena_distance\");\n\nif ( inout == \"1\" ) then\n  txt = \"IN\";\n  sumUsers = sumUsers + 1;\nelse\n  txt = \"OUT OF\";\nend;\ntxt = txt .. \" home (\" .. dist .. \")\";\nfibaro:call(197, \"setProperty\", \"ui.Label3.value\",\n  txt);\nfibaro:call(197, \"setProperty\", \"ui.Label4.value\",\n  os.date(\"%d.%m %X\", MT));\n\n-----\n\nlocal inout, MT = fibaro:getGlobal(\"LeraInHomeB\");\nlocal dist = fibaro:getGlobalValue(\"Lera_distance\");\n\nif ( inout == \"1\" ) then\n  txt = \"IN\";\n  sumUsers = sumUsers + 1;\nelse\n  txt = \"OUT OF\";\nend;\ntxt = txt .. \" home (\" .. dist .. \")\";\nfibaro:call(197, \"setProperty\", \"ui.Label5.value\",\n  txt);\nfibaro:call(197, \"setProperty\", \"ui.Label6.value\",\n  os.date(\"%d.%m %X\", MT));\n\n-----\n\nfibaro:call(197, \"setProperty\", \"ui.Slider1.value\",\n  tostring(sumUsers * 33));\n","buttonIcon":0,"favourite":false,"main":true}]},{"type":"button","elements":[{"id":15,"lua":true,"waitForResponse":false,"caption":"pingTest","name":"Button21","empty":false,"msg":"--[[local tcpSocket = Net.FTcpSocket(\"192.168.4.105\", 34567);\nbytes, errCode = tcpSocket:write(\"test\");\nif errCode == 0\nthen\n  fibaro:call(197, \"setProperty\", \"ui.Label1.Value\", \"ok\");\n  fibaro:debug(\"ok\");\nelse\n  fibaro:call(197, \"setProperty\", \"ui.Label1.Value\", \"err\");\n  fibaro:debug(\"no\");\nend\n]]--\n\n--[[\nfibaro:call(144, \"sendPush\", \"AAAA!!!!!\");\nfibaro:call(249, \"sendPush\", \"BBBB!!!!!\");\nfibaro:call(59, \"sendPhotoToUser\", \"52\");\n--]]\n\nfibaro:call(59, \"sendPhotoToEmail\", \"mechanist@class-assistance.com\");\n\n--fibaro:call(59, \"sendPhotoToEmail\", \"mechanist@claster.tel\");\n\n--fibaro:call(59, \"sendPhotoToEmail\", \"mechaniston@gmail.com\");\n--fibaro:call(2, \"sendEmail\", \"TEST!\", \"FHC is cool\");\n--[[ToUser\", \"2\");\n\tsetTimeout(function()\n\t\tfibaro:call(59, \"sendPhotoToUser\", \"52\");\n\tend, 10000)\n]]--\n--[[\n  154 -- Lena\n  157 -- Lera\n  184 -- Mech\n--]]","buttonIcon":0,"favourite":false,"main":false}]}]},"actions":{"pressButton":1,"setSlider":2,"setProperty":2}}